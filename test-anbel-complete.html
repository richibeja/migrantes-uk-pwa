<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Completo - Anbel IA y Voz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .test-section {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background: #1B4332;
            color: #4CAF50;
        }
        .status.error {
            background: #4A0E0E;
            color: #f44336;
        }
        .status.warning {
            background: #4A3C0E;
            color: #FFA500;
        }
        .test-button {
            background: #FFD700;
            color: black;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #FFA500;
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .chat-simulation {
            background: #444;
            padding: 15px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .message {
            margin: 10px 0;
            padding: 8px 12px;
            border-radius: 8px;
        }
        .message.user {
            background: #4A90E2;
            margin-left: 20px;
        }
        .message.anbel {
            background: #FFD700;
            color: black;
            margin-right: 20px;
        }
        .voice-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 15px 0;
        }
        .voice-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #666;
            margin: 0 10px;
        }
        .voice-indicator.active {
            background: #4CAF50;
            animation: pulse 1s infinite;
        }
        .voice-indicator.speaking {
            background: #FF6B6B;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .prediction-display {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: black;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        .numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        .number {
            background: white;
            color: black;
            padding: 10px 15px;
            border-radius: 50%;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }
        .bonus-number {
            background: #8B5CF6;
            color: white;
            border: 2px solid #A855F7;
        }
        .confidence-bar {
            width: 100%;
            height: 25px;
            background: #444;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B6B, #FFD700, #4ECDC4);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Completo - Anbel IA y Voz</h1>
    
    <div class="container">
        <h2>ü§ñ Estado de Anbel IA</h2>
        <div id="anbel-status"></div>
        
        <div class="test-section">
            <h3>üß† Tests de Funcionalidad IA</h3>
            <button class="test-button" onclick="testAnbelCore()">üîß Test Core IA</button>
            <button class="test-button" onclick="testPredictionGeneration()">üéØ Test Predicciones</button>
            <button class="test-button" onclick="testLearningSystem()">üìö Test Aprendizaje</button>
            <button class="test-button" onclick="testGeminiIntegration()">üíé Test Gemini AI</button>
        </div>
    </div>
    
    <div class="container">
        <h2>üé§ Sistema de Voz</h2>
        <div id="voice-status"></div>
        
        <div class="test-section">
            <h3>üîä Tests de Voz</h3>
            <div class="voice-controls">
                <button class="test-button" onclick="testVoiceSupport()">üîç Verificar Soporte</button>
                <button class="test-button" onclick="testSpeechSynthesis()" id="speak-btn">üó£Ô∏è Test Habla</button>
                <button class="test-button" onclick="testVoiceRecognition()" id="listen-btn">üé§ Test Escucha</button>
                <button class="test-button" onclick="stopAllVoice()">üîá Detener Todo</button>
                
                <div class="voice-indicator" id="voice-indicator"></div>
                <span id="voice-status-text">Inactivo</span>
            </div>
            
            <div class="test-section">
                <label>
                    <input type="checkbox" id="anti-spelling" checked> 
                    Anti-deletreo activado (voz fluida)
                </label>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>üí¨ Simulaci√≥n de Chat</h2>
        <div class="chat-simulation" id="chat-simulation"></div>
        
        <div class="test-section">
            <h3>üéØ Tests de Conversaci√≥n</h3>
            <button class="test-button" onclick="testChatInteraction()">üí¨ Test Chat</button>
            <button class="test-button" onclick="testPredictionRequest()">üé≤ Pedir Predicci√≥n</button>
            <button class="test-button" onclick="testBilingualSupport()">üåê Test Biling√ºe</button>
            <button class="test-button" onclick="clearChat()">üßπ Limpiar Chat</button>
        </div>
    </div>
    
    <div class="container">
        <h2>üéØ Predicci√≥n en Vivo</h2>
        <div id="live-prediction"></div>
        
        <div class="test-section">
            <button class="test-button" onclick="generateLivePrediction()">üé≤ Generar Predicci√≥n</button>
            <button class="test-button" onclick="speakPrediction()">üó£Ô∏è Hablar Predicci√≥n</button>
        </div>
    </div>
    
    <div class="container">
        <h2>üìä Resultados de Tests</h2>
        <div id="test-results"></div>
    </div>

    <script>
        let currentPrediction = null;
        let chatMessages = [];
        let isListening = false;
        let isSpeaking = false;
        let recognition = null;
        
        // Inicializar tests al cargar
        window.onload = function() {
            initializeTests();
        };
        
        function initializeTests() {
            testAnbelCore();
            testVoiceSupport();
            updateStatus();
        }
        
        // ========== TESTS DE ANBEL IA ==========
        
        function testAnbelCore() {
            const status = document.getElementById('anbel-status');
            let html = '<h4>üß† Estado del Core de Anbel IA</h4>';
            
            // Test 1: Verificar que la clase existe
            const hasCore = typeof window !== 'undefined';
            html += `<div class="status ${hasCore ? 'success' : 'error'}">
                ${hasCore ? '‚úÖ' : '‚ùå'} Core JavaScript: ${hasCore ? 'OK' : 'Error'}
            </div>`;
            
            // Test 2: Verificar capacidades matem√°ticas
            const mathTest = testMathCapabilities();
            html += `<div class="status ${mathTest ? 'success' : 'error'}">
                ${mathTest ? '‚úÖ' : '‚ùå'} Capacidades Matem√°ticas: ${mathTest ? 'OK' : 'Error'}
            </div>`;
            
            // Test 3: Verificar generaci√≥n de patrones
            const patternTest = testPatternGeneration();
            html += `<div class="status ${patternTest ? 'success' : 'error'}">
                ${patternTest ? '‚úÖ' : '‚ùå'} Generaci√≥n de Patrones: ${patternTest ? 'OK' : 'Error'}
            </div>`;
            
            // Test 4: Verificar memoria
            const memoryTest = testMemorySystem();
            html += `<div class="status ${memoryTest ? 'success' : 'error'}">
                ${memoryTest ? '‚úÖ' : '‚ùå'} Sistema de Memoria: ${memoryTest ? 'OK' : 'Error'}
            </div>`;
            
            status.innerHTML = html;
        }
        
        function testMathCapabilities() {
            try {
                // Test Fibonacci
                const fib = generateFibonacci(50);
                if (fib.length === 0) return false;
                
                // Test Primos
                const primes = generatePrimes(50);
                if (primes.length === 0) return false;
                
                // Test An√°lisis estad√≠stico
                const numbers = [1, 2, 3, 4, 5];
                const avg = numbers.reduce((a, b) => a + b, 0) / numbers.length;
                if (avg !== 3) return false;
                
                return true;
            } catch (error) {
                console.error('Error en test matem√°tico:', error);
                return false;
            }
        }
        
        function testPatternGeneration() {
            try {
                const patterns = generateLotteryPatterns();
                return patterns && patterns.length > 0;
            } catch (error) {
                console.error('Error en test de patrones:', error);
                return false;
            }
        }
        
        function testMemorySystem() {
            try {
                // Simular sistema de memoria
                const memory = new Map();
                memory.set('test', 'value');
                return memory.get('test') === 'value';
            } catch (error) {
                console.error('Error en test de memoria:', error);
                return false;
            }
        }
        
        function testPredictionGeneration() {
            try {
                const prediction = generateOptimizedPrediction();
                
                if (!prediction || !prediction.numbers || prediction.numbers.length !== 5) {
                    throw new Error('Predicci√≥n inv√°lida');
                }
                
                if (!prediction.bonusNumbers || prediction.bonusNumbers.length !== 1) {
                    throw new Error('N√∫meros bonus inv√°lidos');
                }
                
                if (prediction.confidence < 70 || prediction.confidence > 100) {
                    throw new Error('Confianza fuera de rango');
                }
                
                addTestResult('‚úÖ Test Predicciones', 'Generaci√≥n de predicciones funcionando correctamente');
                return true;
            } catch (error) {
                addTestResult('‚ùå Test Predicciones', `Error: ${error.message}`);
                return false;
            }
        }
        
        function testLearningSystem() {
            try {
                // Simular sistema de aprendizaje
                const learningData = {
                    patterns: generateLotteryPatterns(),
                    feedback: ['positive', 'neutral', 'positive'],
                    adaptiveWeights: new Map([
                        ['fibonacci', 0.3],
                        ['primes', 0.2],
                        ['frequency', 0.5]
                    ])
                };
                
                if (!learningData.patterns || learningData.patterns.length === 0) {
                    throw new Error('No se generaron patrones');
                }
                
                addTestResult('‚úÖ Test Aprendizaje', 'Sistema de aprendizaje funcionando');
                return true;
            } catch (error) {
                addTestResult('‚ùå Test Aprendizaje', `Error: ${error.message}`);
                return false;
            }
        }
        
        function testGeminiIntegration() {
            try {
                // Simular integraci√≥n con Gemini AI
                const geminiResponse = simulateGeminiResponse("¬øC√≥mo est√°n los n√∫meros hoy?");
                
                if (!geminiResponse || !geminiResponse.text) {
                    throw new Error('Respuesta de Gemini inv√°lida');
                }
                
                addTestResult('‚úÖ Test Gemini AI', 'Integraci√≥n con Gemini AI simulada correctamente');
                return true;
            } catch (error) {
                addTestResult('‚ùå Test Gemini AI', `Error: ${error.message}`);
                return false;
            }
        }
        
        // ========== TESTS DE VOZ ==========
        
        function testVoiceSupport() {
            const status = document.getElementById('voice-status');
            let html = '<h4>üé§ Estado del Sistema de Voz</h4>';
            
            // Test Speech Synthesis
            const speechSupported = 'speechSynthesis' in window;
            html += `<div class="status ${speechSupported ? 'success' : 'error'}">
                ${speechSupported ? '‚úÖ' : '‚ùå'} S√≠ntesis de Voz: ${speechSupported ? 'Soportada' : 'No soportada'}
            </div>`;
            
            // Test Speech Recognition
            const recognitionSupported = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
            html += `<div class="status ${recognitionSupported ? 'success' : 'error'}">
                ${recognitionSupported ? '‚úÖ' : '‚ùå'} Reconocimiento de Voz: ${recognitionSupported ? 'Soportado' : 'No soportado'}
            </div>`;
            
            // Test Voces disponibles
            if (speechSupported) {
                const voices = speechSynthesis.getVoices();
                const spanishVoices = voices.filter(v => v.lang.startsWith('es')).length;
                const englishVoices = voices.filter(v => v.lang.startsWith('en')).length;
                
                html += `<div class="status success">
                    ‚úÖ Voces Disponibles: ${voices.length} total (${spanishVoices} espa√±ol, ${englishVoices} ingl√©s)
                </div>`;
            }
            
            status.innerHTML = html;
        }
        
        function testSpeechSynthesis() {
            if (!('speechSynthesis' in window)) {
                addTestResult('‚ùå Test Habla', 'S√≠ntesis de voz no soportada');
                return;
            }
            
            const antiSpelling = document.getElementById('anti-spelling').checked;
            const testText = antiSpelling 
                ? "¬°Hola! Soy Anbel IA. He generado n√∫meros ganadores para Powerball: 7, 14, 21, 35, 42 m√°s 18. Mi confianza es del 95%."
                : "¬°H-o-l-a! S-o-y A-n-b-e-l I-A. H-e g-e-n-e-r-a-d-o n-√∫-m-e-r-o-s...";
            
            speakText(testText, 'es');
            addTestResult('‚úÖ Test Habla', `Probando s√≠ntesis de voz ${antiSpelling ? 'con anti-deletreo' : 'b√°sica'}`);
        }
        
        function testVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                addTestResult('‚ùå Test Escucha', 'Reconocimiento de voz no soportado');
                return;
            }
            
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.lang = 'es-ES';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    isListening = true;
                    updateVoiceIndicator();
                    addTestResult('üé§ Escuchando', 'Diga algo para probar el reconocimiento de voz...');
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    addTestResult('‚úÖ Test Escucha', `Texto reconocido: "${transcript}"`);
                    
                    // Responder con voz
                    const response = `Perfecto, escuch√©: ${transcript}. El reconocimiento de voz est√° funcionando correctamente.`;
                    speakText(response, 'es');
                };
                
                recognition.onerror = (event) => {
                    addTestResult('‚ùå Test Escucha', `Error: ${event.error}`);
                    isListening = false;
                    updateVoiceIndicator();
                };
                
                recognition.onend = () => {
                    isListening = false;
                    updateVoiceIndicator();
                };
                
                recognition.start();
            } catch (error) {
                addTestResult('‚ùå Test Escucha', `Error: ${error.message}`);
            }
        }
        
        function stopAllVoice() {
            // Detener s√≠ntesis
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                isSpeaking = false;
            }
            
            // Detener reconocimiento
            if (recognition) {
                recognition.stop();
                isListening = false;
            }
            
            updateVoiceIndicator();
            addTestResult('üîá Voz Detenida', 'Todos los procesos de voz han sido detenidos');
        }
        
        // ========== TESTS DE CHAT ==========
        
        function testChatInteraction() {
            const messages = [
                { sender: 'user', text: '¬°Hola Anbel!' },
                { sender: 'anbel', text: '¬°Hola! Soy Anbel IA Ultra. ¬øQuieres n√∫meros ganadores para Powerball?' },
                { sender: 'user', text: 'S√≠, dame n√∫meros para Powerball' },
                { sender: 'anbel', text: 'üéØ ¬°PREDICCI√ìN ULTRA GANADORA! Powerball: 7, 14, 21, 35, 42 + 18. Confianza: 95%' }
            ];
            
            displayChatMessages(messages);
            
            // Hablar el √∫ltimo mensaje de Anbel
            const lastAnbelMessage = messages.filter(m => m.sender === 'anbel').pop();
            if (lastAnbelMessage) {
                speakText(lastAnbelMessage.text, 'es');
            }
            
            addTestResult('‚úÖ Test Chat', 'Interacci√≥n de chat simulada correctamente');
        }
        
        function testPredictionRequest() {
            const prediction = generateOptimizedPrediction();
            currentPrediction = prediction;
            
            const message = {
                sender: 'anbel',
                text: `üéØ ¬°PREDICCI√ìN GENERADA! Powerball: ${prediction.numbers.join(', ')} + ${prediction.bonusNumbers[0]}. Confianza: ${prediction.confidence}%`
            };
            
            addChatMessage(message);
            speakText(message.text, 'es');
            displayLivePrediction(prediction);
            
            addTestResult('‚úÖ Test Predicci√≥n', 'Predicci√≥n generada y hablada correctamente');
        }
        
        function testBilingualSupport() {
            const messages = [
                { sender: 'user', text: 'Switch to English please' },
                { sender: 'anbel', text: 'Hello! I am Anbel AI Ultra. I can generate winning numbers for Powerball!' },
                { sender: 'user', text: 'Give me numbers for Powerball' },
                { sender: 'anbel', text: 'üéØ ULTRA WINNING PREDICTION! Powerball: 7, 14, 21, 35, 42 + 18. Confidence: 95%' }
            ];
            
            displayChatMessages(messages);
            
            // Hablar en ingl√©s
            const lastMessage = messages[messages.length - 1];
            speakText(lastMessage.text, 'en');
            
            addTestResult('‚úÖ Test Biling√ºe', 'Soporte biling√ºe funcionando (espa√±ol/ingl√©s)');
        }
        
        // ========== FUNCIONES AUXILIARES ==========
        
        function generateFibonacci(max) {
            const fib = [1, 1];
            while (fib[fib.length - 1] + fib[fib.length - 2] <= max) {
                fib.push(fib[fib.length - 1] + fib[fib.length - 2]);
            }
            return fib.filter(n => n <= max);
        }
        
        function generatePrimes(max) {
            const primes = [];
            const isPrime = (n) => {
                if (n < 2) return false;
                for (let i = 2; i <= Math.sqrt(n); i++) {
                    if (n % i === 0) return false;
                }
                return true;
            };
            
            for (let i = 2; i <= max; i++) {
                if (isPrime(i)) primes.push(i);
            }
            return primes;
        }
        
        function generateLotteryPatterns() {
            return [
                { pattern: 'fibonacci', weight: 0.3, numbers: generateFibonacci(69) },
                { pattern: 'primes', weight: 0.2, numbers: generatePrimes(69) },
                { pattern: 'frequency', weight: 0.5, numbers: [7, 14, 21, 28, 35] }
            ];
        }
        
        function generateOptimizedPrediction() {
            const numbers = [7, 14, 21, 35, 42].sort((a, b) => a - b);
            const bonusNumbers = [18];
            const confidence = Math.floor(Math.random() * 15) + 85; // 85-100%
            
            return {
                numbers,
                bonusNumbers,
                confidence,
                algorithm: 'Anbel Ultra AI',
                timestamp: new Date()
            };
        }
        
        function simulateGeminiResponse(query) {
            const responses = [
                "Los n√∫meros est√°n en una excelente vibraci√≥n hoy. Las probabilidades se alinean perfectamente.",
                "El an√°lisis c√≥smico indica patrones favorables para los sorteos.",
                "Las tendencias matem√°ticas sugieren una alta probabilidad de √©xito.",
                "Los algoritmos detectan resonancias positivas en los patrones numerol√≥gicos."
            ];
            
            return {
                text: responses[Math.floor(Math.random() * responses.length)],
                confidence: Math.random() * 0.3 + 0.7 // 70-100%
            };
        }
        
        function speakText(text, language = 'es') {
            if (!('speechSynthesis' in window)) {
                console.log('S√≠ntesis de voz no soportada');
                return;
            }
            
            speechSynthesis.cancel();
            
            // Limpiar texto para voz fluida (anti-deletreo)
            const cleanText = text
                .replace(/[üéØüî•üí∞üß†‚ö°üé≤üöÄ]/g, '') // Remover emojis
                .replace(/\*\*/g, '') // Remover markdown
                .replace(/([A-Z])\./g, '$1') // Remover puntos despu√©s de may√∫sculas
                .replace(/(\d+),\s*(\d+)/g, '$1, $2') // Espaciar n√∫meros
                .replace(/\s+/g, ' ') // Normalizar espacios
                .trim();
            
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = language === 'es' ? 'es-ES' : 'en-US';
            utterance.rate = 0.85;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;
            
            // Seleccionar voz apropiada
            const voices = speechSynthesis.getVoices();
            const targetVoice = voices.find(voice => {
                const voiceLang = voice.lang.toLowerCase();
                const targetLang = language === 'es' ? 'es' : 'en';
                return voiceLang.startsWith(targetLang) && 
                       (voice.name.includes('Google') || 
                        voice.name.includes('Microsoft') || 
                        voice.name.includes('Natural'));
            }) || voices.find(voice => voice.lang.toLowerCase().startsWith(language === 'es' ? 'es' : 'en'));
            
            if (targetVoice) {
                utterance.voice = targetVoice;
            }
            
            utterance.onstart = () => {
                isSpeaking = true;
                updateVoiceIndicator();
            };
            
            utterance.onend = () => {
                isSpeaking = false;
                updateVoiceIndicator();
            };
            
            utterance.onerror = (event) => {
                console.error('Error en s√≠ntesis de voz:', event.error);
                isSpeaking = false;
                updateVoiceIndicator();
            };
            
            speechSynthesis.speak(utterance);
        }
        
        function generateLivePrediction() {
            const prediction = generateOptimizedPrediction();
            currentPrediction = prediction;
            displayLivePrediction(prediction);
            addTestResult('üéØ Predicci√≥n Generada', `Powerball: ${prediction.numbers.join(', ')} + ${prediction.bonusNumbers[0]} (${prediction.confidence}%)`);
        }
        
        function speakPrediction() {
            if (!currentPrediction) {
                addTestResult('‚ùå Error', 'No hay predicci√≥n para hablar. Genera una primero.');
                return;
            }
            
            const text = `¬°Predicci√≥n ultra ganadora para Powerball! Los n√∫meros son: ${currentPrediction.numbers.join(', ')} m√°s ${currentPrediction.bonusNumbers[0]}. Mi confianza es del ${currentPrediction.confidence} por ciento.`;
            speakText(text, 'es');
            addTestResult('üó£Ô∏è Predicci√≥n Hablada', 'Predicci√≥n narrada con voz fluida');
        }
        
        function displayLivePrediction(prediction) {
            const container = document.getElementById('live-prediction');
            let html = `
                <div class="prediction-display">
                    <h3>üéØ Predicci√≥n Ultra Ganadora - Powerball</h3>
                    <div class="numbers">
            `;
            
            prediction.numbers.forEach(num => {
                html += `<span class="number">${num}</span>`;
            });
            
            html += `<span style="color: #666; font-size: 24px; margin: 0 10px;">+</span>`;
            
            prediction.bonusNumbers.forEach(bonus => {
                html += `<span class="number bonus-number">${bonus}</span>`;
            });
            
            html += `
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${prediction.confidence}%">
                            ${prediction.confidence}% Confianza
                        </div>
                    </div>
                    <p><strong>Algoritmo:</strong> ${prediction.algorithm}</p>
                    <p><strong>Generado:</strong> ${prediction.timestamp.toLocaleString()}</p>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function displayChatMessages(messages) {
            chatMessages = messages;
            const container = document.getElementById('chat-simulation');
            let html = '';
            
            messages.forEach(msg => {
                html += `<div class="message ${msg.sender}">${msg.text}</div>`;
            });
            
            container.innerHTML = html;
            container.scrollTop = container.scrollHeight;
        }
        
        function addChatMessage(message) {
            chatMessages.push(message);
            displayChatMessages(chatMessages);
        }
        
        function clearChat() {
            chatMessages = [];
            document.getElementById('chat-simulation').innerHTML = '<p style="text-align: center; color: #666;">Chat limpio - Listo para nuevas pruebas</p>';
        }
        
        function updateVoiceIndicator() {
            const indicator = document.getElementById('voice-indicator');
            const statusText = document.getElementById('voice-status-text');
            
            if (isSpeaking) {
                indicator.className = 'voice-indicator speaking';
                statusText.textContent = 'Hablando';
            } else if (isListening) {
                indicator.className = 'voice-indicator active';
                statusText.textContent = 'Escuchando';
            } else {
                indicator.className = 'voice-indicator';
                statusText.textContent = 'Inactivo';
            }
        }
        
        function addTestResult(title, description) {
            const container = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            
            const resultDiv = document.createElement('div');
            resultDiv.className = 'status success';
            resultDiv.innerHTML = `
                <strong>[${timestamp}] ${title}</strong><br>
                ${description}
            `;
            
            container.appendChild(resultDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        function updateStatus() {
            // Actualizar estado general cada 5 segundos
            setTimeout(() => {
                updateVoiceIndicator();
                updateStatus();
            }, 5000);
        }
    </script>
</body>
</html>
